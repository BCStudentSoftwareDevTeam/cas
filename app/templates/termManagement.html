<!--This is html file is made dynamically, most of the materials and the texts that appear on the interface are saved in the config file so that they can be changed only at one place in case anything chnanges in the future on the processes-->
<!-- the button names are stored in the create_db-->
{% extends "base.html" %} {% set currentPage = "termManagement" %} {% block body %}
{% include "snips/messages.html" %}
<link rel="stylesheet" href="../static/css/termManagement.css" >
<script type="text/javascript" src="/static/js/local/termManagement.js"></script>

<div class="container-fluid" >
  <div class="panel panel-default">
    <!--TERM MANAGEMENT-->
    <div class="panel-heading" class = "panel_color" style = 'text-align:left;'>
      <div class="row">
        <div class="col-sm-3">
          <span>Keys:</span><br>
          <span class="glyphicon glyphicon-stop" ></span><span> Term</span> <br>
          <span class="glyphicon glyphicon-stop" style="color:#68D3BE;"> </span><span> Completed</span><br>
          <span class="glyphicon glyphicon-stop" style="color:lightgrey"></span><span> Not Completed</span>
        </div>
        <div class="col-sm-5 text-center">
          <h2 class="display-4">Term Management</h2>
          <h5> Click below on the <i><a>term</a></i> to begin <h5>
        </div>
<!--------------------------------Create Term---------------------------------------------------------------------------------------------------------->
        <div class="col-sm-4">
          <div id="createNewTerm">
            <div style = 'text-align:center;'>
              <label for="newTerm"><bold>Create a new term</bold></label>
              <form action="\newTerm" method="post" id="newTerm" class="form-inline">
                <div class="form-group">
                  <select class="form-control" name="keyValue">
                      {% for key in cfg['termInfo'] %}
                        <option value="{{key}}" required>
                          {{cfg['termInfo'][key]}}
                        </option>
                      {% endfor %}
                  </select>
                </div>
                <div class="form-group">
                  <select class="form-control" name="year">
                      {% for year in years %}
                        <option value="{{year}}" required>
                          {{year}}
                        </option>
                      {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                  <input type="submit" class="btn btn-success" value="Save">
                </div>
              </form>
            </div>
          </div>
        </div>
<!--------------------------------------------End----CREATE A NEW TERM---------------------------------------->
      </div>
    </div>
     <!--<br>-->
    <table class="table container" cellspacing="0" cellpadding="0" style="margin-top:20px;">
        {% include "snips/termModal.html" %}
        {% for term in terms %}
        <tr  id = "{{ term.termCode }}" class = "row">
          <td > 
          {% for state in term_state %}
            {% if state.number == 0 %}
              <td style="margin-top:1px !important; padding-top: 1px !important;">
                <!-- Generates the term buttons-->
                <button style="width: 100%;" type="button" class="btn btn-primary terms_btn" data-target="#order{{state.order + 1}}" aria-expanded="false" 
                aria-controls="order{{state.order + 1}}" onclick="showPanel({{term.termCode}},this); enableTheOne('#{{term.termCode}} #btn{{state.order + 1}}');" id = "{{term.termCode}}_{{term.term_state.order}}">{{term.name}} 
                </button> 
              </td>      
            {% else %}
            <!--This cater for the archiving state which is not the menu tab on the row, generates the other six menu tabs-->
              {% if state.number != 7 %}
                <td style="padding: 1px !important; margin: 1px !important;">
                  <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Click Term on the left to enter Term">
                  <button style="width:100%;" class="theButtons btn btn-dark" type = "button" id = "btn{{state.order}}" data-target="#order{{state.order}}" 
                  aria-expanded="false" aria-controls="order{{state.order}}"
                  onclick="showPanel({{term.termCode}},this);)" disabled> {{state.display_name}} <span class="glyphicon glyphicon-chevron-right"></span></button>
                  </span>
                </td>  
              {% endif %}
            {% endif %}
          {% endfor %}
        </td>
        <td>
          
        </td>
        </tr>
        <tr  id = "hidden_{{ term.termCode }}">
          <td colspan="9" id = "divForPanel{{term.termCode}}" style="padding-left:12.5%; padding-right:8%;" > <!-- Calls the panels for each button in  term--> </td>
        </tr>
        {% endfor %}
    </table>
  </div>
  
  <!--Panel that pop upon term click-->
    <div id = "allPanels">
      <div class=" "> 
      <div class="">
      <!--Creates the variable for the states and loops through all the states and genrates the appropriate pannels as specified by the if statement-->
      {% set format0 = [1,2,4] %}
      {% set format1 = [3,5] %}
      {% set format2 = [6] %}
      {% for state in term_state %}
        <!-- loops through states in format 1 that was created before the start of for the for loop above -->
        {% if state.number in format0 %}
            <div id="order{{state.order}}" class="collapse"> 
                    <!--<a onclick="close_panel(order{{state.order}})" class="close" >&times </a>-->
                    <button onclick="close_panel(order{{state.order}})" style="padding-right:5px;"type="button" class="close" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
              <div class="panel-body panel_color" style="height: 180px">
                <div class = "row text-center">
                   <p><b>{{cfg['states'][state.number]['mainInfo']}}</b></p> <!--Access the state number from the config file and then get the value of mainInfo -->
                </div>
                <div class = "row" style="padding-top:20px;">
                <div class = "col-sm-10 text-center">
                  <p><i>{{cfg['states'][state.number]['subtext']}}</i></p>
                </div>
                <div class = "col-sm-2">
                  <button class="btn btn-sm btn-success" type="button" id="button{{state.number}}" data-toggle="collapse" data-target="#order{{state.order}},#order{{state.order + 1}}" aria-expanded="false" 
                  aria-controls="order{{state.order + 1}}" onclick="enableTheOne('btn{{state.order + 1}}'); prevcolor('btn{{state.order}}'); change_text();submit_data({{state.order}},'false');">{{state.display_name}}<span class="glyphicon glyphicon-chevron-right"> </span></button>
                </div>
                </div>
              </div>
            </div>
        {% endif %}
        <!-- checks through states in format 1 that was created before the start of the for loop above -->
        {% if state.number in format1 %}
          <div id="order{{state.order}}" class="collapse panel_color">
                    <button onclick="close_panel(order{{state.order}})" style="padding-right:5px;"type="button" class="close" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
            <div style="height:180px;">
                <div class = "row text-center" >
                    <p><b>{{cfg['states'][state.number]['mainInfo']}}</b> </p>
                </div>
                <div class ="row " style="padding: 5px 5px;">
                  <div class = "col-sm-6">
                     <p><br><i>{{cfg['states'][state.number]['left_help_text']}}</i></p>
                     <!-- this is for the unlock button --->
                      <button class="btn btn-sm btn-danger" type = "button" id = "button{{state.order-1}}" data-toggle="collapse" data-target="#order{{state.order - 1}}, #order{{state.order}}" aria-expanded="false" 
                      aria-controls="{{state.order-1}}" onclick="enableTheOne('btn{{state.order-1}}'); reverseFunc('btn{{state.order-1}}', {{state.order-1}});"> <span class="glyphicon glyphicon-chevron-left"></span>{{cfg['states'][state.order - 1]['btn']}}</button>
                  </div>
                  <div class = "col-sm-6 text-right">
                      <p><br><i>{{cfg['states'][state.number]['right_help_text']}}</i></p>
                      <!--- this is for the lock button --->
                      <button class="btn btn-sm btn-success" type = "button" id = "button{{state.order + 1}}" data-toggle="collapse" data-target="#order{{state.order + 1}}, #order{{state.order}}"  aria-expanded="false" 
                      aria-controls="{{state.order + 1}}" onclick ="enableTheOne('btn{{state.order + 1}}'); prevcolor('btn{{state.order}}'); submit_data({{state.order}}, 'false');" >
                        {{state.display_name}}
                        <span class="glyphicon glyphicon-chevron-right"></span>
                      </button>
                      <br>
                      <p style="padding-top: 5px;">
                        <sub>
                          <br> 
                            {{cfg['states'][state.number]['subtext']}}
                        </sub>
                      </p>
                  </div>
                  <div class = "text-center">
                    <a onclick = 'downloadCourses()' data-target="#download_alert1" data-toggle="modal">{{cfg['states'][state.number]['download']}}</a>
                  </div>
                </div>
              </div>
            </div>
            
            <div id="download_alert1" class="modal fade" tabindex = "-1" role="dialog">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title">Downloading ...</h6>
                  </div>
                  <div class="modal-body">
                    <p>File will be ready to view momentarily</p>
                  </div>
                </div>
              </div>
            </div>
            
          {% endif %}
        <!-- checks through states in format 2 that was created before the start of the for loop above -->
        {% if state.number in format2 %} 
          <!--FINISH-->
           <div id="order{{state.order}}" class="collapse">
              <div class = "panel-body panel_color" style="height:180px;">
                <div class = "row text-center">
                  <p><b>{{cfg['states'][state.number]['mainInfo']}}</b></p>
                </div>
                <div class="row" style="padding-top:20px;">
                  <div class = "col-sm-3 text-left">
                    <!--Click below to go to Room resolutions page-->
                    <p><sub>{{cfg['states'][state.number]['goto_text']}}</sub></p>
                    <a onclick = "goto_roomResolution()">{{cfg['states'][state.number]['goto_link']}}</a>
                  </div>
                  <div class= "col-sm-6 text-center">
                    <p style="padding-bottom:10px;">
                      <sub><br>{{cfg['states'][state.number]['left_help_text']}}</sub>
                    </p>
                    <!--Reassign Button-->
                    <button type = "button" id = "button{{state.order}}" class= "btn btn-danger"  data-toggle = "collapse" aria-expanded="false" data-target= "#reassignModal"
                     aria-controls="order{{state.order-1}}">
                       {{cfg['states'][state.number]['btn']}}
                    </button>
                  </div>
                  <div class = "col-sm-3 text-right"> 
                    <!-- Click to finish term-->
                    <p style="padding-bottom:10px;"><sub>{{cfg['states'][state.number]['right_help_text']}}</sub><br></p>
                      <!--Finish button-->
                    <button type="button" id ="button{{state.order}}" class="btn btn-success finalize" data-toggle="collapse" data-target= "#order{{state.order + 1}}" aria-controls="order{{state.order + 1}}" 
                        onclick="enableTheOne('btn{{state.order}}'); prevcolor('btn{{state.order}}');submit_data({{state.order}},'false'); collapser();"> {{state.display_name}}
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
     <div id="reassignModal" class="modal" tabindex = "-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Reasign term</h4>
            </div>
            <div class="modal-body">
              <p>Are you sure you are ready to reassign the term?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="#reassignModal" onclick="enableTheOne('btn{{state.order}}'); submit_data({{state.order}}-1,'false'); close_reassignModal(); reassign_confirm();" >Yes</button>
              <button type="button" class="btn btn-default" data-dismiss="modal"onclick="close_reassignModal()">No</button>
            </div>
          </div>
        </div>
      </div>
      
         {% endif %}
            <!--The archive panel and the button after finish-->
         <div id="order7" class="collapse" >
            <div class = "panel-footer" style="height: 180px;">
              <div class = "row text-center">
                <p><b>This term is complete</b></p><br>
                <p>(Couse and Room Preferences are no longer accepted, and rooms have been assigned.)</p>
              </div>
              <div class = "row">
                  <div class = "col-sm-4" >
                    <br> 
                    <a onclick = "downloadCourses()" data-target="#download_alert" data-toggle="modal">Download Courses</a>
                    <br>
                    <br>
                    <sub>(Click link to view courses)</sub>
                  </div>      
                  {# Download Rooms is no longer needed by itself because the data it would contain is being added to the downloadCourses #}
                  <div class = "col-sm-4">  
                    <br>
                    <!--<a>Download Rooms </a>-->
                  </div>
                <div class = "col-sm-4 text-right"> 
                    <input type = "button" class = "btn btn-danger" id = "Archive"  data-target ="#myModal" data-toggle="modal" aria-expanded="false" value = "Archive" onclick = ""></input><br>
                    <br><p><sub>(Archiving will hide the term from view in other CAS interfaces.)</sub></p>
                </div>
              </div>
            </div>
          </div>
      {% endfor %}
      
      <div id="download_alert" class="modal fade" tabindex = "-1" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h6 class="modal-title">Downloading ...</h6>
            </div>
            <div class="modal-body">
              <p>File will be ready to view momentarily</p>
            </div>
          </div>
        </div>
      </div>
      
      
      
     <!--This is the modal for onclick on archive button confirmation-->
     <div id="myModal" class="modal fade" tabindex = "-1" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Archive term</h4>
            </div>
            <div class="modal-body">
              <p>Are you sure you are ready to archive the term?</p>
              <sub>You will not be able to view the term upon reload!</sub>
            </div>
            <div class="modal-footer">
              <!--<button type="button" class="btn btn-default" data-dismiss="modal" onclick="change_btn_name(); archiveTerm('false'); close_panel(order7)">Yes</button>-->
              <button type="button" class="btn btn-default" data-dismiss="modal" onclick="archiveTerm('false'); close_panel(order7)">Yes</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
            </div>
          </div>
        </div>
      </div>
      
    </div>
    </div>
  </div>
</div>
<script>
  

</script>
{% endblock %}